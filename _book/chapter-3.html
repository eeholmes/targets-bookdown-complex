<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Chapter 3 | Targets + Bookdown</title>
  <meta name="description" content="4 Chapter 3 | Targets + Bookdown" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Chapter 3 | Targets + Bookdown" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Chapter 3 | Targets + Bookdown" />
  
  
  

<meta name="author" content="Eli Holmes" />


<meta name="date" content="2022-02-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="here-is-chapter-2.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#to-run-the-book"><i class="fa fa-check"></i><b>1.1</b> To run the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#to-add-chapters"><i class="fa fa-check"></i><b>1.2</b> To add chapters</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="here-is-chapter-1.html"><a href="here-is-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Here is chapter 1</a></li>
<li class="chapter" data-level="3" data-path="here-is-chapter-2.html"><a href="here-is-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Here is chapter 2</a></li>
<li class="chapter" data-level="4" data-path="chapter-3.html"><a href="chapter-3.html"><i class="fa fa-check"></i><b>4</b> Chapter 3</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-3.html"><a href="chapter-3.html#how-to-run-this."><i class="fa fa-check"></i><b>4.1</b> How to run this.</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-3.html"><a href="chapter-3.html#packages"><i class="fa fa-check"></i><b>4.2</b> Packages</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-3.html"><a href="chapter-3.html#setup"><i class="fa fa-check"></i><b>4.3</b> Setup</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-3.html"><a href="chapter-3.html#globals"><i class="fa fa-check"></i><b>4.4</b> Globals</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-3.html"><a href="chapter-3.html#targets"><i class="fa fa-check"></i><b>4.5</b> Targets</a></li>
<li class="chapter" data-level="4.6" data-path="chapter-3.html"><a href="chapter-3.html#pipeline"><i class="fa fa-check"></i><b>4.6</b> Pipeline</a></li>
<li class="chapter" data-level="4.7" data-path="chapter-3.html"><a href="chapter-3.html#output"><i class="fa fa-check"></i><b>4.7</b> Output</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Targets + Bookdown</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-3" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Chapter 3</h1>
<p>This chapter shows how you might use Target Markdown to create a target
pipeline for a specific chapter. It will create the {target} files in
the chapter folder so you’ll want a separate folder for the chapter. To
work on the chapter, you would set the working directory to the chapter
folder. Then you can use the usual {targets} workflow and
visualizations.</p>
<p>The chapter at <a href="https://books.ropensci.org/targets/markdown.html" class="uri">https://books.ropensci.org/targets/markdown.html</a> walks
through it in detail. This R Markdown template is based off what you get
using File &gt; New &gt; RMarkdown &gt; Template &gt; Targets Markdown</p>
<div id="how-to-run-this." class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> How to run this.</h2>
<p>Just hit the Knit button.</p>
<p>What’s it going to do? Basically it will create the target objects in
<code>_targets</code> and then the markdown text will use those target objects.
That way you don’t end up re-running lengthy things. How is this
different from caching? Well you explicitly specify the dependencies of
your objects. {targets} is smart and will figure out if it needs to
re-make an object based on whether it or its dependencies changed. Also
caching crashes {bookdown} constantly.</p>
</div>
<div id="packages" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Packages</h2>
<p>The example requires several R packages, and <code>targets</code> must be version
0.5.0.9000 or above.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chapter-3.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;biglm&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;targets&quot;</span>, <span class="st">&quot;tidyr&quot;</span>))</span></code></pre></div>
</div>
<div id="setup" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Setup</h2>
<p>If you are using old versions of <code>targets</code> (&lt;= 0.7.0) and/or <code>knitr</code>
(&lt;= 1.33), you will need to load the <code>targets</code> package in the R
Markdown document in order for Target Markdown code chunks to work.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chapter-3.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span></code></pre></div>
<p>Near the top of the document, you may also wish to remove the
<code>_targets_r</code> directory previously written by non-interactive runs of the
report. Otherwise, your pipeline may contain superfluous targets.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapter-3.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb5-2"><a href="chapter-3.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_unscript</span>()</span></code></pre></div>
</div>
<div id="globals" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Globals</h2>
<p>We first define some global options/functions common to all targets. The
function below plots a histogram of ozone concentrations, and our
histogram target will need it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chapter-3.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tidyverse.quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-2"><a href="chapter-3.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;biglm&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;tidyr&quot;</span>))</span>
<span id="cb6-3"><a href="chapter-3.html#cb6-3" aria-hidden="true" tabindex="-1"></a>create_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb6-4"><a href="chapter-3.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb6-5"><a href="chapter-3.html#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> Ozone), <span class="at">bins =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="chapter-3.html#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_gray</span>(<span class="dv">24</span>)</span>
<span id="cb6-7"><a href="chapter-3.html#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-8"><a href="chapter-3.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Establish _targets.R and _targets_r/globals/example-globals.R.</span></span></code></pre></div>
</div>
<div id="targets" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Targets</h2>
<p>This is the important part. Notice that it uses <code>{targets ...}</code> not
<code>{r ...}</code>. You need to define dependencies (like data) as a target
object so that {targets} can keep track of whether it needs to update
objects based on changes to its dependencies.</p>
<p><em>How will you use these?</em> Not here. This is just defining them. Scroll
down to see how to use them. Note you don’t have to define all your
targets in one place. Scroll down to see examples.</p>
<p>Our first target borrows the <code>airquality</code> dataset built into base R.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapter-3.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_target</span>(raw_data, airquality)</span>
<span id="cb7-2"><a href="chapter-3.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Establish _targets.R and _targets_r/targets/raw-data.R.</span></span></code></pre></div>
<p>Our next targets preprocess the data, make a histogram, and fit a model.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chapter-3.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb8-2"><a href="chapter-3.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(data, raw_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ozone))),</span>
<span id="cb8-3"><a href="chapter-3.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(hist, <span class="fu">create_plot</span>(data))</span>
<span id="cb8-4"><a href="chapter-3.html#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-5"><a href="chapter-3.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Establish _targets.R and _targets_r/targets/downstream-targets.R.</span></span></code></pre></div>
<p>Set the <code>tar_simple</code> chunk option to <code>TRUE</code> to define a single target
with the command in the code chunk. The chunk below only contains
<code>biglm(Ozone ~ Wind + Temp, data)</code> in the source, but because
<code>tar_simple</code> is <code>TRUE</code>, it is shorthand for
<code>tar_target(name = fit, command = biglm(Ozone ~ Wind + Temp, data))</code>.
All other arguments to <code>tar_target()</code> are set to their default values
(configurable with <code>tar_option_set()</code>).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapter-3.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_target</span>(fit, {</span>
<span id="cb9-2"><a href="chapter-3.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">biglm</span>(Ozone <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Wind <span class="sc">+</span> Temp, data)</span>
<span id="cb9-3"><a href="chapter-3.html#cb9-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-4"><a href="chapter-3.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Define target fit from chunk code.</span></span>
<span id="cb9-5"><a href="chapter-3.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Establish _targets.R and _targets_r/targets/fit.R.</span></span></code></pre></div>
<p>You need to be careful how you name things. You don’t want to name an
object to the name of a targets object. So like in the code above, you
don’t want to use <code>data</code> as a name in that code chunk since <code>data</code> is
now a targets object.</p>
</div>
<div id="pipeline" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Pipeline</h2>
<p>If you ran all the <code>{targets}</code> chunks in non-interactive mode, then your
R scripts are set up to run the pipeline. <em>I don’t know what this
means.</em></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="chapter-3.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span>
<span id="cb10-2"><a href="chapter-3.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31m✓ skip target raw_data</span></span>
<span id="cb10-3"><a href="chapter-3.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39m[31m✓ skip target data</span></span>
<span id="cb10-4"><a href="chapter-3.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39m[31m✓ skip target fit</span></span>
<span id="cb10-5"><a href="chapter-3.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39m[31m✓ skip target hist</span></span>
<span id="cb10-6"><a href="chapter-3.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39m[31m✓ skip pipeline</span></span>
<span id="cb10-7"><a href="chapter-3.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39m[31mWarning message:</span></span>
<span id="cb10-8"><a href="chapter-3.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; package ‘targets’ was built under R version 4.1.2 </span></span>
<span id="cb10-9"><a href="chapter-3.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39m</span></span></code></pre></div>
</div>
<div id="output" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Output</h2>
<p>You can retrieve results from the <code>_targets/</code> data store using
<code>tar_read()</code> or <code>tar_load()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chapter-3.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biglm)</span>
<span id="cb11-2"><a href="chapter-3.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(fit)</span>
<span id="cb11-3"><a href="chapter-3.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Large data regression model: biglm(Ozone ~ -1 + Wind + Temp, data)</span></span>
<span id="cb11-4"><a href="chapter-3.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample size =  116</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chapter-3.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_read</span>(hist)</span></code></pre></div>
<p><img src="rendered-chapters/chap3_files/figure-gfm/unnamed-chunk-6-1.png" /><!-- --></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="here-is-chapter-2.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
